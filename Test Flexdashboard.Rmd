---
title: "Group Project ERHS 535 : Invasive Species in the Top 15 National Parks"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggthemes)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(pheatmap)
library(viridis)
library(plotly)

most_visited_nps_species_data <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-10-08/most_visited_nps_species_data.csv")

```

Column {data-width=400}
-----------------------------------------------------------------------
### Invasive Species in the Top 15 National Parks
Look at invasive species across the united states top 15 most visited national parks


### Big map 

```{r}

```



Column {data-width=250}
-----------------------------------------------------------------------

### Heat Map 

```{r}

```

### Chart C

```{r}
# 2. Heat map invasive species vs national parks 
#x-axis will be national parks, y-axis will be kingdom (category name)
# Preparing the data
invasive_data <- most_visited_nps_species_data %>%
  filter(Nativeness == "Non-native") %>%
  filter(!(CategoryName %in% c("Crab/Lobster/Shrimp", "Spider/Scorpion", "Protozoa"))) %>%  # Excluding categories with no observations
  select(ParkName, CategoryName, References) %>%
  mutate(ParkName = str_remove(ParkName, " National Park$")) %>%  # Remove "National Park" at the end of the name
  group_by(ParkName, CategoryName) %>%
  summarize(TotalReferences = sum(References, na.rm = TRUE), .groups = 'drop')

# Some National Parks don't have data for certain categories
# Creating a complete dataset with all combinations of ParkName and CategoryName
all_combinations <- expand_grid(
  ParkName = unique(invasive_data$ParkName),
  CategoryName = unique(invasive_data$CategoryName)
)

# Merging with the existing data and filling missing combinations with 0 so that it can be colored
invasive_data <- all_combinations %>%
  left_join(invasive_data, by = c("ParkName", "CategoryName")) %>%
  mutate(TotalReferences = replace_na(TotalReferences, 0))  # Replace NAs with 0

# Calculating total references by category to sort by density of observations
category_totals <- invasive_data %>%
  group_by(CategoryName) %>%
  summarize(TotalReferences = sum(TotalReferences, na.rm = TRUE)) %>%
  arrange(desc(TotalReferences))  # Sort by total references

# Reorder categories based on density
invasive_data <- invasive_data %>%
  mutate(CategoryName = factor(CategoryName, levels = rev(category_totals$CategoryName))) 

# Plot using geom_raster with viridis color palette and use original TotalReferences in hover text
heatmap <- ggplot(invasive_data, aes(
  x = ParkName,
  y = CategoryName,
  fill = log1p(TotalReferences),
  text = paste("Total References:", TotalReferences)
)) +
  geom_raster() +
  scale_fill_viridis_c(
    option = "rocket",
    direction = -1,  # Reverse the palette for clarity
    name = "Documented\nReferences\n(Log Scale)"
  ) +
  labs(
    title = "Distribution of Invasive Species Across National Parks",
    x = "National Park",
    y = ""
  ) +
  theme_tufte() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Rotate and increase size of x-axis labels
    axis.text.y = element_text(size = 12),  # Increase size of y-axis labels
    plot.title = element_text(hjust = 0.5, size = 16),  # Center and enlarge title
    axis.title.x = element_text(size = 14),  # Increase size of x-axis title
    panel.grid = element_blank()  # Remove grid lines
  )

# Convert ggplot to plotly so that it is interactive
#interactive_plot <- ggplotly(heatmap, tooltip = c("x", "y", "text"))
print(heatmap)




```

